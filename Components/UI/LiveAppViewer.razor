@inject TerminalService TerminalSvc
@inject IJSRuntime JS

<div class="live-app-container">
    <div class="app-toolbar">
        <div class="status-light"></div>
        <div class="address-bar">
            <span class="protocol">HTTPS://</span> @ProjectUrl
        </div>
        <button class="external-btn" @onclick="OpenTab">OUTBOUND_LINK</button>
    </div>

    <div class="iframe-wrapper">
        @if (isLoading)
        {
            <div class="loading-overlay">
                <div class="spinner"></div>
                <p>ESTABLISHING_REMOTE_UPLINK...</p>
            </div>
        }
        <iframe src="@ProjectUrl" @onload="HandleLoad" class="app-frame"></iframe>
    </div>
</div>

@code {
    [Parameter] public string ProjectUrl { get; set; } = "";
    private bool isLoading = true;

    private void HandleLoad()
    {
        isLoading = false;
        TerminalSvc.AddLog($"Handshake successful. Remote app mounted.", LogType.Success);
    }

    private async Task OpenTab() => await JS.InvokeVoidAsync("open", ProjectUrl, "_blank");
}
