@inject ThemeService ThemeSvc
@inject TerminalService TerminalSvc
@inject ProjectStateService ProjectState


<div class="sidebar-explorer">
    <div class="explorer-header">EXPLORER: PORTFOLIO_OS</div>

    @foreach (var group in ProjectManifest.GroupBy(p => p.Category))
    {
        <div class="category-folder">
            <span class="arrow">▼</span> @group.Key.ToUpper()
        </div>

        @foreach (var file in group)
        {
            <div class="file-item @(SelectedFile == file ? "active" : "")"
                 @onclick="() => HandleFileClick(file)">
                <span class="file-icon">@file.Icon</span>
                <span class="file-name">@file.FileName</span><span class="file-ext">@file.Extension</span>
            </div>
        }
    }
</div>

@code {
    private ProjectFile? SelectedFile;

    [Parameter] public EventCallback<ProjectFile> OnFileSelected { get; set; }

    // --- YOUR HARDCODED MANIFEST ---
    private List<ProjectFile> ProjectManifest = new()
{
    // SYSTEM & IDENTITY
    new ProjectFile { FileName = "Identity", Extension = ".cs", Category = "SYSTEM", AccentColor = "#FFFFFF", Icon = "👤" },
    new ProjectFile { FileName = "Uplink", Extension = ".link", Category = "SYSTEM", AccentColor = "#FFD700", Icon = "📡" },

    // WPF DESKTOP APPLICATIONS (Triggers the WpfWindow)
    new ProjectFile {
        FileName = "TitanVault",
        Extension = ".xaml",
        Category = "WPF_CORE",
        AccentColor = "#39FF14", // Matrix Green
        Icon = "🛡️"
    },
    new ProjectFile {
        FileName = "HydraAnalytics",
        Extension = ".xaml",
        Category = "WPF_CORE",
        AccentColor = "#00F3FF", // Cyan
        Icon = "📊"
    },

    // BLAZOR WEB PROJECTS (Triggers the CodeEditor/LiveView)
    new ProjectFile {
        FileName = "NeuralNet_Dashboard",
        Extension = ".razor",
        Category = "BLAZOR_WASM",
        AccentColor = "#BC13FE", // Voltage Violet
        Icon = "🧠"
    },
    new ProjectFile {
        FileName = "SignalR_Chat_Node",
        Extension = ".razor",
        Category = "BLAZOR_WASM",
        AccentColor = "#FF3131", // Neon Red
        Icon = "⚡"
    }
};

    protected override void OnInitialized()
    {
        // Optionally, select the first file by default
        ProjectState.SelectFile(ProjectManifest.First(p => p.FileName == "Uplink"));
    }

    //  var filteredProjects = ProjectManifest.Where(p => p.FileName.Contains(searchTerm, StringComparison.OrdinalIgnoreCase));

    private async Task HandleFileClick(ProjectFile file)
    {
        SelectedFile = file;

        // 1. Update the global site glow
        ThemeSvc.UpdateTheme(file.AccentColor);

        // 2. Log the action to your new Terminal Service
        TerminalSvc.AddLog($"Loading module: {file.FileName}{file.Extension}...", LogType.System);
        TerminalSvc.AddLog($"Setting environment accent to {file.AccentColor}.", LogType.Success);

        // 3. (Optional) Navigate or Update Main Stage
        ProjectState.SelectFile(file); // This is where the variable is "Set"

        if (file.Extension == ".link")
        {
            TerminalSvc.AddLog("WARNING: Establishing unencrypted bridge to external nodes...", LogType.Warning);
            TerminalSvc.AddLog("UPLINK_PROTOCOL: Active.", LogType.Success);
        }
        else
        {
            TerminalSvc.AddLog($"Accessing {file.FileName}...", LogType.System);
        }

        await OnFileSelected.InvokeAsync(file); // This triggers the parent's method
    }

    
    
   
}
